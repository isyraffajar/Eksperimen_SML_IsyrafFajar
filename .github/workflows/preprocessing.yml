name: Preprocessing Workflow

# Trigger workflow: push ke main atau manual trigger
on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  preprocess:
    runs-on: ubuntu-latest

    steps:
    # 1️ Checkout repository
    - name: Checkout repository
      uses: actions/checkout@v3

    # 2️ Setup Python 3.12
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'

    # 3️ Install dependencies
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas scikit-learn imbalanced-learn

    # 4️ Jalankan automate.py
    - name: Run automate.py
      run: |
        python preprocessing/automate_Isyraf.py
        mkdir -p preprocessing/namadataset_preprocessing
        mv Customer-Churn_processed.csv preprocessing/namadataset_preprocessing/

    # 5️ Commit & push hasil preprocess
    - name: Commit processed dataset
      run: |
        git config --global user.name "github-actions"
        git config --global user.email "actions@github.com"
        git add preprocessing/namadataset_preprocessing/Customer-Churn_processed.csv
        git commit -m "Update processed dataset [skip ci]" || echo "No changes to commit"
        git push origin main
